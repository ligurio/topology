<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>topology API reference</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">





<!-- Menu -->

<div id="navigation">
<br/>
<h1>topology</h1>


<h2>Contents</h2>
<ul>
<li><a href="#Module_functions">Module functions </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><strong>topology.topology</strong></li>
</ul>

</div>

<div id="content">

<h1>Module <code>topology.topology</code></h1>
<p>topology module</p>
<p><table class="markdown_table">
</table>
</p>


<h2><a href="#Module_functions">Module functions </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#new">new (conf_client, name[, autocommit[, opts]])</a></td>
	<td class="summary">Create a new topology.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.new_instance">instance.new_instance (self, instance_name[, opts[, replicaset_name]])</a></td>
	<td class="summary">Add a new Tarantool instance to a topology.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.new_replicaset">instance.new_replicaset (self, replicaset_name[, opts])</a></td>
	<td class="summary">Add new replicaset to a topology.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.delete_instance">instance.delete_instance (self, instance_name)</a></td>
	<td class="summary">Delete instance from a topology.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.delete_replicaset">instance.delete_replicaset (self, replicaset_name)</a></td>
	<td class="summary">Delete a replicaset.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.set_instance_options">instance.set_instance_options (self, instance_name, opts)</a></td>
	<td class="summary">Set parameters of existed Tarantool instance.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.set_replicaset_options">instance.set_replicaset_options (self, replicaset_name, opts)</a></td>
	<td class="summary">Set parameters of an existed replicaset in a topology.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.set_instance_reachable">instance.set_instance_reachable (self, instance_name)</a></td>
	<td class="summary">Switch state of Tarantool instance to a reachable.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.set_instance_unreachable">instance.set_instance_unreachable (self, instance_name)</a></td>
	<td class="summary">Switch state of Tarantool instance to a unreachable.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.set_topology_options">instance.set_topology_options (self, opts)</a></td>
	<td class="summary">Set topology options.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_routers">instance.get_routers (self)</a></td>
	<td class="summary">Get routers.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_storages">instance.get_storages (self[, vshard_group])</a></td>
	<td class="summary">Get storages.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_instance_options">instance.get_instance_options (self, instance_name)</a></td>
	<td class="summary">Get instance options.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_replicaset_options">instance.get_replicaset_options (self, replicaset_name)</a></td>
	<td class="summary">Get replicaset options.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_topology_options">instance.get_topology_options (self)</a></td>
	<td class="summary">Get topology options.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_vshard_config">instance.get_vshard_config (self[, vshard_group])</a></td>
	<td class="summary">Get vshard configuration.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_instances_it">instance.get_instances_it (self)</a></td>
	<td class="summary">Get instances iterator.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.get_replicasets_it">instance.get_replicasets_it (self)</a></td>
	<td class="summary">Get replicasets iterator.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.new_instance_link">instance.new_instance_link (self, upstream, downstreams)</a></td>
	<td class="summary">Add a new instance link.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#instance.delete_instance_link">instance.delete_instance_link (self, upstream, downstreams)</a></td>
	<td class="summary">Delete an instance link.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#topology_obj.delete">topology_obj.delete (self)</a></td>
	<td class="summary">Delete topology.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#topology_obj.commit">topology_obj.commit (self)</a></td>
	<td class="summary">Send local changes to remote configuration storage.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#topology_obj.on_change">topology_obj.on_change (self, function_cb, time_interval)</a></td>
	<td class="summary">Execute function on changes in remote topology.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Module_functions"></a>Module functions </h2>

    <dl class="function Functions">
    <dt>
    <a name="new"></a>
    <strong>new (conf_client, name[, autocommit[, opts]])</strong>
    </dt>
    <dd>
    <p>Create a new topology. <table class="markdown_table">
</table>
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">conf_client</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     A configuration client object. See <a href="https://tarantool.github.io/conf/">Configuration storage module</a>.</p>
        </span>
        </li>
        <li><span class="parameter">name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     A topology name.</p>
        </span>
        </li>
        <li><span class="parameter">autocommit</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Enable mode of operation of a configuration storage connection. Each
     individual configuration storage interaction submitted through the
     configuration storage connection in autocommit mode will be executed in its own
     transaction that is implicitly committed. Enabled by default.</p>
        </span>
        </li>
        <li><span class="parameter">opts</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>

        <br>
        <span class="parameter-description">
        <p>
     Topology options.</p>
        </span>
        <ul>
        <li><span class="parameter">vshard_groups</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Parameters of vshard storage groups. Instance that has a <code>vshard-storage</code>
     role can belong to different vshard storage groups. For example,
     <code>hot</code> or <code>cold</code> groups meant to independently process hot and cold data.
     With multiple groups enabled, every replica set with a vshard-storage
     role enabled must be assigned to a particular group. The assignment can never
     be changed. By default there is a single vshard group 'default' and by default
     instances without vshard group belongs to the 'default' group.
     Every vshard group contains sharding parameters specific for this group.
     See more about vshard storage groups in <a href="https://www.tarantool.io/en/doc/latest/book/cartridge/cartridge_dev/#using-multiple-vshard-storage-groups">Tarantool Cartridge Developers Guide</a>.
     Sharding group may contain sharding configuration parameters described in
     <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_ref/">Sharding Configuration reference</a>.
<p>
     - <code>bucket_count</code> - Total bucket count in a cluster. It can not be changed
     after cluster bootstrap! Default: 3000.
<p>     - <code>rebalancer_disbalance_threshold</code> - Maximal bucket count that can be
     received in parallel by single replicaset. Default: 1.
<p>     - <code>rebalancer_max_receiving</code> - The maximum number of buckets that can be
     received in parallel by a single replica set. Default: 100.
<p>     - <code>rebalancer_max_sending</code> - The degree of parallelism for parallel rebalancing.
     Works for storages only, ignored for routers. Default: 1.
<p>
     - <code>discovery_mode</code> - A mode of a bucket discovery fiber:
     'on', 'off' or 'once'. Default: 'on'.
<p>     - <code>sync_timeout</code> - Timeout to wait for synchronization of the old
     master with replicas before demotion. Used when switching a master
     or when manually calling the <code>sync()</code> function. Default: 1.
<p>     - <code>collect_lua_garbage</code> - If set to true, the Lua <code>collectgarbage()</code>
     function is called periodically. Default: false.
<p>     - <code>collect_bucket_garbage_interval</code> - The interval between garbage
     collector actions, in seconds. Default: 0.5.
<p>     - <code>shard_index</code> - Name or id of a TREE index over the bucket id.
     Default: 'bucket_id'.
</p>
        </span>
        </li>
        <li><span class="parameter">zone_distances</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     A field defining the configuration of relative distances for each zone
     pair in a replica set. See <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_ref/#confval-weights">Sharding Configuration reference</a> and
     <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_admin/#vshard-replica-set-weights">Sharding Administration</a>.
</p>
        </span>
        </li>
        <li><span class="parameter">failover</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     TBD
     See more about failover configuration in <a href="https://www.tarantool.io/en/doc/latest/book/cartridge/cartridge_dev/#failover-architecture">Tarantool Cartridge Developers Guide</a>.
<p>  <span class="xxx">XXX</span>: <code>failover</code> option is untested.
</p>
        </span>
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">TopologyConfig</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="keyword">local</span> conf_lib = <span class="global">require</span>(<span class="string">'conf'</span>)
<span class="keyword">local</span> topology_lib = <span class="global">require</span>(<span class="string">'topology'</span>)

<span class="keyword">local</span> urls = {
    <span class="string">'http://localhost:2380'</span>,
    <span class="string">'http://localhost:2381'</span>,
    <span class="string">'http://localhost:2382'</span>,
}
<span class="keyword">local</span> conf_client = conf_lib.new({ driver = <span class="string">'etcd'</span>, endpoints = urls })
<span class="keyword">local</span> t = topology_lib.new(conf_client, <span class="string">'tweedledum'</span>)</pre>
    </ul>

</dd>
    <dt>
    <a name="instance.new_instance"></a>
    <strong>instance.new_instance (self, instance_name[, opts[, replicaset_name]])</strong>
    </dt>
    <dd>
    <p>Add a new Tarantool instance to a topology. <table class="markdown_table">
</table>
<p>
 Add a new Tarantool instance to a topology.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">instance_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Tarantool instance name to add. Name must be globally unique.</p>
        </span>
        </li>
        <li><span class="parameter">opts</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>

        <br>
        <span class="parameter-description">
        <p>
     instance options.</p>
        </span>
        <ul>
        <li><span class="parameter">box_cfg</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Instance box.cfg options. box.cfg options should contain at least Uniform Resource Identifier
     of remote instance with **required** login and password. See <a href="https://www.tarantool.io/en/doc/latest/reference/configuration/#box-cfg-params">Configuration parameters</a>.
     Note: instance uuid will be generated automatically.
     See <a href="https://www.tarantool.io/en/doc/latest/reference/configuration/#box-cfg-params">Configuration reference</a>.</p>
        </span>
        </li>
        <li><span class="parameter">replicaset</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Replicaset name.</p>
        </span>
        </li>
        <li><span class="parameter">advertise_uri</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     URI that will be used by clients to connect to this instance.
     A "URI" is a "Uniform Resource Identifier" and it's format is described in <a href="https://www.tarantool.io/en/doc/latest/reference/reference_lua/uri/#uri-parse">Module uri</a>.</p>
        </span>
        </li>
        <li><span class="parameter">zone</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     The <code>router</code> sends all read-write requests to the master instance only.
     Setting replica zones allows sending read-only requests not only to
     the master instance, but to any available replica that is the ‘nearest’
     to the router. Zone can be used, for example, to define the
     physical distance between the router and each replica in each replica set.
     In this case read requests are sent to the nearest replica (with the lowest distance).
     Option used in a table <code>zone_distances</code> in <a href="index.html#new">Create a new topology</a>.
     See more in <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_admin/#replica-weights">Sharding Administration</a>.</p>
        </span>
        </li>
        <li><span class="parameter">status</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Instance status, possible values are 'reachable' and 'unreachable'.
     Instance status also can be managed by:
<p><ul class="markdown_list">
<li><a href="index.html#instance.set_instance_reachable">self.set_instance_reachable()</a> set to status <code>reachable</code></li>
<li><a href="index.html#instance.set_instance_unreachable">self.set_instance_unreachable()</a> set to status <code>unreachable</code></li>
<li><a href="index.html#instance.new_instance">self.new_instance()</a> set to status <code>reachable</code> by default</li>
<li><a href="index.html#instance.set_instance_options">self.set_instance_options()</a> set to status <code>reachable</code> or <code>unreachable</code></li>
<li><a href="index.html#instance.delete_instance">self.delete_instance()</a> set to status <code>expelled</code></li>
</ul></p>
        </span>
        </li>
        <li><span class="parameter">vshard_groups</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Names of vshard storage groups. Instance that has a <code>vshard-storage</code>
     role can belong to different vshard storage groups. For example,
     <code>hot</code> or <code>cold</code> groups meant to independently process hot and cold data.
     With multiple groups enabled, every replica set with a vshard-storage
     role enabled must be assigned to a particular group. The assignment can never
     be changed.
     See more about vshard storage groups in <a href="https://www.tarantool.io/en/doc/latest/book/cartridge/cartridge_dev/#using-multiple-vshard-storage-groups">Tarantool Cartridge Developers Guide</a>.</p>
        </span>
        </li>
        <li><span class="parameter">is_master</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">boolean</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     True if an instance is a master in replication cluster. See <a href="https://www.tarantool.io/en/doc/latest/book/replication/repl_architecture/">Replication architecture</a>.
     You can define 0 or 1 masters for each replicaset. It accepts all write requests.</p>
        </span>
        </li>
        <li><span class="parameter">is_storage</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">boolean</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     True if an instance is a storage. See <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_architecture/#structure">Sharding Architecture</a>.</p>
        </span>
        </li>
        <li><span class="parameter">is_router</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">boolean</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     True if an instance is a router. See <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_architecture/#structure">Sharding Architecture</a>.
</p>
        </span>
        </li>
        </li></ul>
        <li><span class="parameter">replicaset_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Replicaset name. Name must be globally unique.
     It will be created if it does not exist.</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.new_replicaset"></a>
    <strong>instance.new_replicaset (self, replicaset_name[, opts])</strong>
    </dt>
    <dd>
    <p>Add new replicaset to a topology. <table class="markdown_table">
</table>
<p>
 Adds a new replicaset to a topology.
<p> Note: replication cluster UUID will be generated automatically.
 See <a href="https://www.tarantool.io/en/doc/latest/reference/configuration/#confval-replicaset_uuid">Configuration reference</a>. By default used replication topology
 is fullmesh. However custom replication topology (see <a href="https://www.tarantool.io/en/doc/latest/book/replication/repl_architecture/#replication-topologies-cascade-ring-and-full-mesh">Replication architecture</a>)
 can be made using methods <a href="index.html#instance.new_instance_link">Create a new instance link</a> and
 <a href="index.html#instance.delete_instance_link">Delete an instance link</a>.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">replicaset_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of replicaset to add. Name must be globally unique.</p>
        </span>
        </li>
        <li><span class="parameter">opts</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>

        <br>
        <span class="parameter-description">
        <p>
     replicaset options.</p>
        </span>
        <ul>
        <li><span class="parameter">master_mode</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Mode that describes how master instance should be assigned.
     Possible values:
<p>       - single - it is allowed to have only a single master in replication
         cluster that should me assigned manually.
<p>       - multimaster - it is allowed to have several instances with master role
         in a replication cluster, all of them should be assigned manually.
<p>       - auto - master role will be assigned automatically. Auto mode
         requires specifying advisory roles (<code>leader</code>, <code>follower</code>, or <code>candidate</code>)
         in Tarantool instance options (<code>box.cfg</code>). See <a href="https://www.tarantool.io/en/doc/latest/reference/reference_lua/box_info/election/">box.info.election</a>.
<p>
 <span class="xxx">XXX</span>: <code>master_mode</code> option is untested.
</p>
        </span>
        </li>
        <li><span class="parameter">failover_priority</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">{false, ...}</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Table with instance names specifying servers failover priority.
<p> <span class="xxx">XXX</span>: <code>failover_priority</code> option is untested.
</p>
        </span>
        </li>
        <li><span class="parameter">weight</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">{false, ...}</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     The weight of a replica set defines the capacity of the replica set:
     the larger the weight, the more buckets the replica set can store.
     The total size of all sharded spaces in the replica set is also its capacity metric.
     By default, all weights of all replicasets are equal.
     See <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_admin/#replica-set-weights">Sharding Administration</a>.
</p>
        </span>
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.delete_instance"></a>
    <strong>instance.delete_instance (self, instance_name)</strong>
    </dt>
    <dd>
    <p>Delete instance from a topology. <table class="markdown_table">
</table>
<p>
 Deletes an instance. Deleted instance still exists in a topology,
 but has a status <code>expelled</code> and it cannot be used anymore.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">instance_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of an instance to delete.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.delete_replicaset"></a>
    <strong>instance.delete_replicaset (self, replicaset_name)</strong>
    </dt>
    <dd>
    <p>Delete a replicaset. <table class="markdown_table">
</table>
<p>
 Deletes replicaset from a topology.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">replicaset_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of a replicaset to delete.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.set_instance_options"></a>
    <strong>instance.set_instance_options (self, instance_name, opts)</strong>
    </dt>
    <dd>
    <p>Set parameters of existed Tarantool instance. <table class="markdown_table">
</table>
<p>
 Set parameters of existed Tarantool instance.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">instance_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Tarantool instance name.</p>
        </span>
        </li>
        <li><span class="parameter">opts</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     <a href="index.html#instance.new_instance">Instance options</a>.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.set_replicaset_options"></a>
    <strong>instance.set_replicaset_options (self, replicaset_name, opts)</strong>
    </dt>
    <dd>
    <p>Set parameters of an existed replicaset in a topology. <table class="markdown_table">
</table>
<p>
 Set parameters of a replicaset in a topology.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">replicaset_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Replicaset name.</p>
        </span>
        </li>
        <li><span class="parameter">opts</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     See description of options in <a href="index.html#instance.new_replicaset">Replicaset options</a>.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.set_instance_reachable"></a>
    <strong>instance.set_instance_reachable (self, instance_name)</strong>
    </dt>
    <dd>
    <p>Switch state of Tarantool instance to a reachable. <table class="markdown_table">
</table>
<p>
 Make instance available for clients. It participate
 in replication and can serve requests.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">instance_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Tarantool instance name.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.set_instance_unreachable"></a>
    <strong>instance.set_instance_unreachable (self, instance_name)</strong>
    </dt>
    <dd>
    <p>Switch state of Tarantool instance to a unreachable. <table class="markdown_table">
</table>
<p>
 Make instance unavailable for clients. It cannot participate
 in replication, it cannot serve requests.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">instance_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Tarantool instance name.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.set_topology_options"></a>
    <strong>instance.set_topology_options (self, opts)</strong>
    </dt>
    <dd>
    <p>Set topology options. <table class="markdown_table">
</table>
<p>
 Set topology options.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">opts</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">table</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     <a href="index.html#new">Topology options</a>.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_routers"></a>
    <strong>instance.get_routers (self)</strong>
    </dt>
    <dd>
    <p>Get routers. <table class="markdown_table">
</table>
<p>
 Get a table with routers in a topology.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
        Topology object.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>

     Map with instance names and their options described in
     <a href="index.html#instance.new_instance">Create a new instance</a>.
<p> Example of response:
<p><pre> {
   'router-1' = {
        is_router = true,
        ...
   },
   'router-2' = {
        is_router = true,
        ...
   },
 }</pre>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_storages"></a>
    <strong>instance.get_storages (self[, vshard_group])</strong>
    </dt>
    <dd>
    <p>Get storages. <table class="markdown_table">
</table>
<p>
 Get a table with storages in a topology.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">vshard_group</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of vshard storage group. See more about vshard storage groups in
     <a href="https://www.tarantool.io/en/doc/latest/book/cartridge/cartridge_dev/#using-multiple-vshard-storage-groups">Tarantool Cartridge Developers Guide</a>.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>

     Map with instance names and their options described in
     <a href="index.html#instance.new_instance">Create a new instance</a>.
<p> Example of response:
<p><pre> {
   'storage-1' = {
        is_storage = true,
        ...
   },
   'storage-2' = {
        is_storage = true,
        ...
   },
 }</pre>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_instance_options"></a>
    <strong>instance.get_instance_options (self, instance_name)</strong>
    </dt>
    <dd>
    <p>Get instance options. <table class="markdown_table">
</table>
<p>
 Get instance options.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">instance_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Tarantool instance name.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>

     Table with with instance options described in <a href="index.html#instance.new_instance">Create a new instance</a>.
     and key <code>box_cfg</code> with table that contains <a href="https://www.tarantool.io/en/doc/latest/reference/configuration/#box-cfg-params">Tarantool configuration parameters</a>.
<p> Example of response:
<p><pre> {
   box_cfg = {
     feedback_enabled = true,
     memtx_memory = 268435456,
     instance_uuid = "79a116a2-a88a-4e6c-9f83-9621127e9aeb",
     read_only = true,
     replicaset_uuid = "2ad6d727-1b19-4241-bde7-301f15575f69",
     replication = {},
     replication_sync_timeout = 6,
     wal_mode = "write"
   },
   is_master = false,
   is_storage = true
 }</pre>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_replicaset_options"></a>
    <strong>instance.get_replicaset_options (self, replicaset_name)</strong>
    </dt>
    <dd>
    <p>Get replicaset options. <table class="markdown_table">
</table>
<p>
 Get replicaset options.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">replicaset_name</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Replicaset name.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>

     Table with replicaset options, see <a href="index.html#instance.new_replicaset">Replicaset options</a>
     and <code>replicas</code> with names of instances added to that replicaset.
<p> Example of response:
<p><pre> {
   cluster_uuid = '2bff7d87-697f-42f5-b7c7-33f40a8db1ea',
   master_mode = 'auto',
   replicas = { 'instance-name-1', 'instance_name-2', 'instance_name-3' }
 }</pre>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_topology_options"></a>
    <strong>instance.get_topology_options (self)</strong>
    </dt>
    <dd>
    <p>Get topology options. <table class="markdown_table">
</table>
<p>
 Get topology options.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>

     Table with topology options, see <a href="index.html#new">Create a new topology</a>,
     and key <code>replicasets</code> that contains a table with names of replicasets
     added to topology.
<p> Example of response:
<p><pre> {
   replicasets = {
      'replicaset_name-1',
      'replicaset_name-2'
   },
   vshard_groups = {
      ...
   },
 }</pre>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_vshard_config"></a>
    <strong>instance.get_vshard_config (self[, vshard_group])</strong>
    </dt>
    <dd>
    <p>Get vshard configuration. <table class="markdown_table">
</table>
<p>
 Method prepares a configuration suitable for vshard bootstrap.
 In sharding participates instances that belongs to specified vshard group
 or group 'default' if it is not specified, has router role and has a
 status 'reachable'.
 See <a href="https://www.tarantool.io/en/doc/latest/book/cartridge/cartridge_dev/#using-multiple-vshard-storage-groups">Sharding quick start guide</a>.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">vshard_group</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>,
                <span class="parameter-modifier">
                <em>optional</em>)
                </span>
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of vshard storage group.
     See more about vshard storage groups in <a href="https://github.com/tarantool/vshard/blob/master/vshard/replicaset.lua">Tarantool Cartridge Developers Guide</a>
     and <a href="https://github.com/tarantool/ansible-cartridge/blob/master/doc/topology.md">Ansible Cartridge Documentation</a>.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>

     Table whose format and possible parameters are defined
     by vshard module and described in <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_quick/">Sharding quick start guide</a> and
     description of basic parameters in <a href="https://www.tarantool.io/en/doc/latest/reference/reference_rock/vshard/vshard_ref/#vshard-config-reference">Sharding configuration reference</a>.
<p> Example of response:
<p><pre> {
     memtx_memory = 100 * 1024 * 1024,
     bucket_count = 10000,
     rebalancer_disbalance_threshold = 10,
     rebalancer_max_receiving = 100,
     sharding = {
         ['cbf06940-0790-498b-948d-042b62cf3d29'] = { -- replicaset #1
             replicas = {
                 ['8a274925-a26d-47fc-9e1b-af88ce939412'] = {
                     uri = 'storage:storage@127.0.0.1:3301',
                     name = 'storage_1_a',
                     master = true
                 },
                 ['3de2e3e1-9ebe-4d0d-abb1-26d301b84633'] = {
                     uri = 'storage:storage@127.0.0.1:3302',
                     name = 'storage_1_b'
                 }
             },
         }, -- replicaset #1
         ['ac522f65-aa94-4134-9f64-51ee384f1a54'] = { -- replicaset #2
             replicas = {
                 ['1e02ae8a-afc0-4e91-ba34-843a356b8ed7'] = {
                     uri = 'storage:storage@127.0.0.1:3303',
                     name = 'storage_2_a',
                     master = true
                 },
                 ['001688c3-66f8-4a31-8e19-036c17d489c2'] = {
                     uri = 'storage:storage@127.0.0.1:3304',
                     name = 'storage_2_b'
                 }
             },
         }, -- replicaset #2
     }, -- sharding
     weights = ...
 }</pre>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.get_instances_it"></a>
    <strong>instance.get_instances_it (self)</strong>
    </dt>
    <dd>
    <p>Get instances iterator. <table class="markdown_table">
</table>
<p>
 Method returns an iterator with pairs 'instance name' and its parameters.
 Quite useful and powerful with library <a href="https://luafun.github.io/">luafun</a>.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>
        Iterator of tables with instances names and their options.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="keyword">local</span> conf_lib = <span class="global">require</span>(<span class="string">'conf'</span>)
<span class="keyword">local</span> topology_lib = <span class="global">require</span>(<span class="string">'topology'</span>)

<span class="keyword">local</span> urls = {
    <span class="string">'http://localhost:2380'</span>,
    <span class="string">'http://localhost:2381'</span>,
    <span class="string">'http://localhost:2382'</span>,
}

<span class="keyword">local</span> conf_client = conf_lib.new({ driver = <span class="string">'etcd'</span>, endpoints = urls })
<span class="keyword">local</span> t = topology_lib.new(conf_client, <span class="string">'Tweedledum_and_Tweedledee'</span>)
t:new_instance(<span class="string">'tweedledum'</span>, {
    is_router = <span class="keyword">true</span>,
})
t:new_instance(<span class="string">'tweedledee'</span>, {
    is_storage = <span class="keyword">true</span>,
})
t:get_instances_it():length() <span class="comment">-- 2
</span><span class="keyword">local</span> predicate_is_storage = <span class="keyword">function</span>(name, opts)
    <span class="keyword">return</span> opts.is_storage == <span class="keyword">true</span>
<span class="keyword">end</span>
t:get_instances_it():remove_if(predicate_is_storage) <span class="comment">-- keep routers only
</span>t:get_replicasets_it():totable() <span class="comment">-- {'tweedledee', 'tweedledum'}
</span><span class="keyword">local</span> instances = t:get_replicasets_it():tomap()
<span class="comment">-- instances['tweedledum']:
</span><span class="comment">-- {
</span><span class="comment">--   box_cfg = {
</span><span class="comment">--     instance_uuid = "9d486fd0-f2c6-4789-9592-ab43d883f320"
</span><span class="comment">--   },
</span><span class="comment">--   is_router = true,
</span><span class="comment">--   status = "reachable",
</span><span class="comment">--   vshard_groups = { "default" }
</span><span class="comment">-- }</span></pre>
    </ul>

</dd>
    <dt>
    <a name="instance.get_replicasets_it"></a>
    <strong>instance.get_replicasets_it (self)</strong>
    </dt>
    <dd>
    <p>Get replicasets iterator. <table class="markdown_table">
</table>
<p>
 Method returns a iterator with pairs 'replicaset name' and its parameters.
 Quite useful and powerful with library <a href="https://luafun.github.io/">luafun</a>.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">table</span></span>
        Iterator of tables with replicasets names and their options.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="keyword">local</span> conf_lib = <span class="global">require</span>(<span class="string">'conf'</span>)
<span class="keyword">local</span> topology_lib = <span class="global">require</span>(<span class="string">'topology'</span>)

<span class="keyword">local</span> urls = {
    <span class="string">'http://localhost:2380'</span>,
    <span class="string">'http://localhost:2381'</span>,
    <span class="string">'http://localhost:2382'</span>,
}

<span class="keyword">local</span> conf_client = conf_lib.new({ driver = <span class="string">'etcd'</span>, endpoints = urls })
<span class="keyword">local</span> t = topology_lib.new(conf_client, <span class="string">'Tweedledum_and_Tweedledee'</span>)
t:new_replicaset(<span class="string">'tweedledum'</span>)
t:new_replicaset(<span class="string">'tweedledee'</span>)

t:get_replicasets_it():length() <span class="comment">-- 2
</span>t:get_replicasets_it():totable() <span class="comment">-- {"tweedledum", "tweedledee"}</span></pre>
    </ul>

</dd>
    <dt>
    <a name="instance.new_instance_link"></a>
    <strong>instance.new_instance_link (self, upstream, downstreams)</strong>
    </dt>
    <dd>
    <p>Add a new instance link. <table class="markdown_table">
</table>
<p>
 Creates a links between instances.
 These links constitutes a replication topology.
<p> <span class="xxx">XXX</span>: Method is not ready.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">upstream</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of upstream instance.</p>
        </span>
        </li>
        <li><span class="parameter">downstreams</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">{...}</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Table with names of downstream instances. These instances will be used
     as downstreams of specified instance anymore.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="instance.delete_instance_link"></a>
    <strong>instance.delete_instance_link (self, upstream, downstreams)</strong>
    </dt>
    <dd>
    <p>Delete an instance link. <table class="markdown_table">
</table>
<p>
 Deletes a links between instances.
 These links constitutes a replication topology.
<p> <span class="xxx">XXX</span>: Method is not ready.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">upstream</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Name of upstream instance.</p>
        </span>
        </li>
        <li><span class="parameter">downstreams</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">{...}</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Table with names of downstream instances. These instances will not be used
     as downstreams of specified instance anymore.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="topology_obj.delete"></a>
    <strong>topology_obj.delete (self)</strong>
    </dt>
    <dd>
    <p>Delete topology. <table class="markdown_table">
</table>
<p>
 Deletes a topology.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="topology_obj.commit"></a>
    <strong>topology_obj.commit (self)</strong>
    </dt>
    <dd>
    <p>Send local changes to remote configuration storage. <table class="markdown_table">
</table>
<p>
 Send topology changes made offline to remote configuration storage.
 Method is applicable with disabled option <code>autocommit</code>, with enabled
 <code>autocommit</code> option does nothing.
 See <a href="index.html#new">Create a new topology</a>.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">true</span></span>
        <table class="markdown_table">
</table>

    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <table class="markdown_table">
</table>
</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        Error description</li>
    </ol>




</dd>
    <dt>
    <a name="topology_obj.on_change"></a>
    <strong>topology_obj.on_change (self, function_cb, time_interval)</strong>
    </dt>
    <dd>
    <p>Execute function on changes in remote topology. <table class="markdown_table">
</table>
<p>
 Function polls remote configuration storage every <code>time interval</code>
 for changes in topology and execute a <code>function callback</code> once
 a change happen.
<p> <span class="xxx">XXX</span>: Method is untested.
 <span class="xxx">XXX</span>: See <a href="https://github.com/bofm/tarantool-autovshard/blob/master/autovshard/consul.lua#L192-L300">autovshard implementation</a>.
</p>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
        <br>
        <span class="parameter-description">
        <p>
     Topology object.</p>
        </span>
        </li>
        <li><span class="parameter">function_cb</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">string</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Callback function that should be executed.</p>
        </span>
        </li>
        <li><span class="parameter">time_interval</span>
            <span class="parameter-info">
                (<span class="types"><span class="type">number</span></span>)
            </span>
        <br>
        <span class="parameter-description">
        <p>
     Specify a poll interval in seconds. Default interval is 0.1 sec.
</p>
        </span>
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        None
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="comment">-- How to update vshard configuration continuously.
</span>
<span class="keyword">local</span> conf_lib = <span class="global">require</span>(<span class="string">'conf'</span>)
<span class="keyword">local</span> topology_lib = <span class="global">require</span>(<span class="string">'topology'</span>)
<span class="keyword">local</span> vshard = <span class="global">require</span>(<span class="string">'vshard'</span>)
<span class="keyword">local</span> fiber = <span class="global">require</span>(<span class="string">'fiber'</span>)

<span class="keyword">local</span> urls = {
    <span class="string">'http://localhost:2380'</span>,
    <span class="string">'http://localhost:2381'</span>,
    <span class="string">'http://localhost:2382'</span>,
}

<span class="keyword">local</span> conf_client = conf_lib.new({ driver = <span class="string">'etcd'</span>, endpoints = urls })
<span class="keyword">local</span> t = topology_lib.new(conf_client, <span class="string">'tweedledum'</span>)

<span class="comment">-- on storage instance
</span><span class="keyword">local</span> vshard_storage_cb = <span class="keyword">function</span>()
   <span class="keyword">local</span> vshard_cfg = t:get_vshard_config()
   vshard.router.cfg(vshard_cfg)
<span class="keyword">end</span>
<span class="keyword">local</span> instance_uuid = <span class="global">os</span>.getenv(<span class="string">'TARANTOOL_UUID'</span>)
<span class="keyword">local</span> vshard_cfg = t:get_vshard_config()
vshard.storage.cfg(vshard_cfg, instance_uuid)
fiber.create(t:on_change, vshard_cfg_cb, <span class="number">0.5</span>)

<span class="comment">-- on router instance
</span><span class="keyword">local</span> vshard_router_cb = <span class="keyword">function</span>()
   <span class="keyword">local</span> vshard_cfg = t:get_vshard_config()
   vshard.router.cfg(vshard_cfg)
<span class="keyword">end</span>
vshard.router.cfg(vshard_cfg)
vshard.router.bootstrap()
fiber.create(t:on_change, vshard_cfg_cb, <span class="number">0.5</span>)</pre>
    </ul>

</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
</div> <!-- id="container" -->
</body>
</html>
